[]
args.client_id_list = None
training_type != FEDML_TRAINING_PLATFORM_CROSS_DEVICE and training_type != FEDML_TRAINING_PLATFORM_CROSS_SILO
bsize is 2
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:04:04] [INFO] [__init__.py:109:print_args] ==== args = {'yaml_config_file': '/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/distributed_training/config.yml', 'run_id': '0', 'rank': 0, 'local_rank': 0, 'node_rank': 0, 'role': 'client', 'yaml_paths': ['/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/distributed_training/config.yml'], 'training_type': 'simulation', 'random_seed': 0, 'dataset': 'ICU', 'data_cache_dir': '/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/eICU_Data/', 'partition_method': 'hetero', 'partition_alpha': 0.5, 'model': 'GRU', 'input_dim': 128, 'hidden_dim': 32, 'num_layers': 2, 'output_dim': 1, 'dropout_prob': 0.05, 'model_dir': '/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/distributed_training/', 'federated_optimizer': 'FedAvg', 'client_id_list': '[]', 'client_num_in_total': 20, 'client_num_per_round': 10, 'comm_round': 5, 'epochs': 2, 'batch_size': 2, 'client_optimizer': 'adamw', 'learning_rate': 0.005, 'weight_decay': 0.005, 'frequency_of_the_test': 1, 'using_gpu': False, 'gpu_id': 0, 'backend': 'sp', 'log_file_dir': '/Users/vscheltjens/fedml-server/fedml/logs', 'enable_wandb': True, 'wandb_key': '8d579c56c0eda8929353aac11d399b96e5aa9e71', 'wandb_entity': 'vs-health', 'wandb_project': 'federated_gru_eicu', 'worker_num': 10, 'sys_perf_profiling': True, 'config_version': 'release', 'current_running_dir': '/Users/vscheltjens/fedml-client', 'os_name': 'MacOS', 'version': 'release', 'device_id': '0xC02F52N9MD6R', 'cloud_region': '', 'mqtt_config_path': '', 's3_config_path': '', 'log_server_url': 'https://open.fedml.ai/fedmlLogsServer/logs/update'}
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:04:04] [INFO] [ml_engine_adapter.py:147:get_torch_device] args = <fedml.arguments.Arguments object at 0x7f8ab0190f70>, using_gpu = False, device_id = 0, device_type = cpu
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:04:04] [INFO] [device.py:48:get_device] device = cpu
Loaded Global dataloaders
81135 24698
covered hospital 0
covered hospital 1
covered hospital 2
covered hospital 3
covered hospital 4
covered hospital 5
covered hospital 6
covered hospital 7
covered hospital 8
covered hospital 9
covered hospital 10
covered hospital 11
covered hospital 12
covered hospital 13
covered hospital 14
covered hospital 15
covered hospital 16
covered hospital 17
covered hospital 18
covered hospital 19
reached target point: model and data loaded -----> start training federated
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:09:34] [INFO] [fedavg_api.py:43:__init__] model = GRUModel(
  (gru): GRU(128, 32, num_layers=2, batch_first=True, dropout=0.05)
  (fc): Linear(in_features=32, out_features=1, bias=True)
  (gru_dropout): Dropout(p=0.05, inplace=False)
  (batch_norm): BatchNorm1d(1, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (relu): ReLU()
)
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:09:34] [INFO] [fedavg_api.py:46:__init__] self.model_trainer = <fedml.ml.trainer.icu_trainer.ModelTrainerICU object at 0x7f8a751e2740>
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:09:34] [INFO] [fedavg_api.py:55:_setup_clients] ############setup_clients (START)#############
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:09:34] [INFO] [fedavg_api.py:67:_setup_clients] ############setup_clients (END)#############
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:09:34] [INFO] [fedavg_api.py:70:train] self.model_trainer = <fedml.ml.trainer.icu_trainer.ModelTrainerICU object at 0x7f8a751e2740>
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:09:34] [INFO] [fedavg_api.py:77:train] ################Communication round : 0
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:09:34] [INFO] [fedavg_api.py:142:_client_sampling] client_indexes = [18  1 19  8 10 17  6 13  4  2]
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:09:34] [INFO] [fedavg_api.py:88:train] client_indexes = [18  1 19  8 10 17  6 13  4  2]
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:10:36] [INFO] [fedavg_api.py:186:_local_test_on_all_clients] ################local_test_on_all_clients : 0
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 10:10:58] [ERROR] [mlops_runtime_log.py:34:handle_exception] Uncaught exception
Traceback (most recent call last):
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/distributed_training/federated.py", line 23, in <module>
    simulator.run()
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/runner.py", line 123, in run
    self.runner.run()
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/simulation/simulator.py", line 67, in run
    self.fl_trainer.train()
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/simulation/sp/fedavg/fedavg_api.py", line 123, in train
    self._local_test_on_all_clients(round_idx)
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/simulation/sp/fedavg/fedavg_api.py", line 219, in _local_test_on_all_clients
    test_local_metrics = client.local_test(True)
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/simulation/sp/fedavg/client.py", line 35, in local_test
    metrics = self.model_trainer.test(test_data, self.device, self.args)
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/ml/trainer/icu_trainer.py", line 109, in test
    avg_metrics = [metric/(i+1) for metric in running_metrics]
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/ml/trainer/icu_trainer.py", line 109, in <listcomp>
    avg_metrics = [metric/(i+1) for metric in running_metrics]
NameError: free variable 'i' referenced before assignment in enclosing scope