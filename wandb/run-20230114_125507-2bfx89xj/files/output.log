[]
args.client_id_list = None
training_type != FEDML_TRAINING_PLATFORM_CROSS_DEVICE and training_type != FEDML_TRAINING_PLATFORM_CROSS_SILO
bsize is 2
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:55:24] [INFO] [__init__.py:109:print_args] ==== args = {'yaml_config_file': '/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/distributed_training/config.yml', 'run_id': '0', 'rank': 0, 'local_rank': 0, 'node_rank': 0, 'role': 'client', 'central_training': 0, 'yaml_paths': ['/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/distributed_training/config.yml'], 'training_type': 'simulation', 'random_seed': 0, 'dataset': 'ICU', 'data_cache_dir': '/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/eICU_Data/', 'partition_method': 'hetero', 'partition_alpha': 0.5, 'model': 'GRU', 'input_dim': 128, 'hidden_dim': 32, 'num_layers': 2, 'output_dim': 1, 'dropout_prob': 0.05, 'dist_model_dir': '/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/distributed_training/', 'central_model_dir': '/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/central_training/', 'federated_optimizer': 'FedAvg', 'client_id_list': '[]', 'client_num_in_total': 10, 'client_num_per_round': 5, 'comm_round': 5, 'epochs': 2, 'batch_size': 2, 'client_optimizer': 'adamw', 'learning_rate': 0.005, 'weight_decay': 0.005, 'central_epochs': 15, 'frequency_of_the_test': 1, 'using_gpu': False, 'gpu_id': 0, 'backend': 'sp', 'log_file_dir': '/Users/vscheltjens/fedml-server/fedml/logs', 'enable_wandb': True, 'wandb_key': '8d579c56c0eda8929353aac11d399b96e5aa9e71', 'wandb_entity': 'vs-health', 'wandb_project': 'federated_gru_eicu', 'worker_num': 5, 'sys_perf_profiling': True, 'config_version': 'release', 'current_running_dir': '/Users/vscheltjens/fedml-client', 'os_name': 'MacOS', 'version': 'release', 'device_id': '0xC02F52N9MD6R', 'cloud_region': '', 'mqtt_config_path': '', 's3_config_path': '', 'log_server_url': 'https://open.fedml.ai/fedmlLogsServer/logs/update'}
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:55:24] [INFO] [ml_engine_adapter.py:147:get_torch_device] args = <fedml.arguments.Arguments object at 0x7f8a38040f70>, using_gpu = False, device_id = 0, device_type = cpu
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:55:24] [INFO] [device.py:48:get_device] device = cpu
Loaded Global dataloaders
81135 24698
covered hospital 0
covered hospital 1
covered hospital 2
covered hospital 3
covered hospital 4
covered hospital 5
covered hospital 6
covered hospital 7
covered hospital 8
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:58:36] [INFO] [fedavg_api.py:43:__init__] model = GRUModel(
  (gru): GRU(128, 32, num_layers=2, batch_first=True, dropout=0.05)
  (fc): Linear(in_features=32, out_features=1, bias=True)
  (gru_dropout): Dropout(p=0.05, inplace=False)
  (batch_norm): BatchNorm1d(1, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (relu): ReLU()
)
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:58:36] [INFO] [fedavg_api.py:46:__init__] self.model_trainer = <fedml.ml.trainer.icu_trainer.ModelTrainerICU object at 0x7f8a0f0c4d00>
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:58:36] [INFO] [fedavg_api.py:55:_setup_clients] ############setup_clients (START)#############
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:58:36] [INFO] [fedavg_api.py:67:_setup_clients] ############setup_clients (END)#############
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:58:36] [INFO] [fedavg_api.py:70:train] self.model_trainer = <fedml.ml.trainer.icu_trainer.ModelTrainerICU object at 0x7f8a0f0c4d00>
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:58:36] [INFO] [fedavg_api.py:77:train] ################Communication round : 0
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:58:36] [INFO] [fedavg_api.py:142:_client_sampling] client_indexes = [2 8 4 9 1]
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:58:36] [INFO] [fedavg_api.py:88:train] client_indexes = [2 8 4 9 1]
covered hospital 9
reached target point: model and data loaded -----> start training federated
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:59:22] [INFO] [fedavg_api.py:186:_local_test_on_all_clients] ################local_test_on_all_clients : 0
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:59:38] [INFO] [fedavg_api.py:240:_local_test_on_all_clients] {'train_MAE': 1.6411422998119654, 'training_loss': 0.25540002022506203}
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:59:38] [INFO] [fedavg_api.py:249:_local_test_on_all_clients] {'test_MAE': 1.7459521604063668, 'test_loss': 0.27901573487654907}
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:59:38] [INFO] [fedavg_api.py:77:train] ################Communication round : 1
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:59:38] [INFO] [fedavg_api.py:142:_client_sampling] client_indexes = [2 9 6 4 0]
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:59:38] [INFO] [fedavg_api.py:88:train] client_indexes = [2 9 6 4 0]
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 12:59:52] [INFO] [fedavg_api.py:186:_local_test_on_all_clients] ################local_test_on_all_clients : 1
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:00:08] [INFO] [fedavg_api.py:240:_local_test_on_all_clients] {'train_MAE': 1.634340835565481, 'training_loss': 0.2603181626963549}
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:00:08] [INFO] [fedavg_api.py:249:_local_test_on_all_clients] {'test_MAE': 1.7069610165200682, 'test_loss': 0.2760740338499799}
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:00:08] [INFO] [fedavg_api.py:77:train] ################Communication round : 2
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:00:08] [INFO] [fedavg_api.py:142:_client_sampling] client_indexes = [4 1 5 0 7]
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:00:08] [INFO] [fedavg_api.py:88:train] client_indexes = [4 1 5 0 7]
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:00:53] [INFO] [fedavg_api.py:186:_local_test_on_all_clients] ################local_test_on_all_clients : 2
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:01:10] [INFO] [fedavg_api.py:240:_local_test_on_all_clients] {'train_MAE': 1.7301823637135954, 'training_loss': 0.24309299108692634}
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:01:10] [INFO] [fedavg_api.py:249:_local_test_on_all_clients] {'test_MAE': 1.815048167626614, 'test_loss': 0.2568697713872993}
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:01:10] [INFO] [fedavg_api.py:77:train] ################Communication round : 3
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:01:10] [INFO] [fedavg_api.py:142:_client_sampling] client_indexes = [5 4 1 2 9]
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:01:10] [INFO] [fedavg_api.py:88:train] client_indexes = [5 4 1 2 9]
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:02:00] [INFO] [fedavg_api.py:186:_local_test_on_all_clients] ################local_test_on_all_clients : 3
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:02:17] [INFO] [fedavg_api.py:240:_local_test_on_all_clients] {'train_MAE': 1.7586727504994202, 'training_loss': 0.246484406838026}
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:02:17] [INFO] [fedavg_api.py:249:_local_test_on_all_clients] {'test_MAE': 1.859069786086636, 'test_loss': 0.2613572730453446}
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:02:17] [INFO] [fedavg_api.py:77:train] ################Communication round : 4
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:02:17] [INFO] [fedavg_api.py:142:_client_sampling] client_indexes = [3 8 4 9 2]
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:02:17] [INFO] [fedavg_api.py:88:train] client_indexes = [3 8 4 9 2]
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:02:31] [INFO] [fedavg_api.py:186:_local_test_on_all_clients] ################local_test_on_all_clients : 4
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:02:47] [INFO] [fedavg_api.py:240:_local_test_on_all_clients] {'train_MAE': 1.705522879686765, 'training_loss': 0.2401329628774526}
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:02:47] [INFO] [fedavg_api.py:249:_local_test_on_all_clients] {'test_MAE': 1.8159093683106917, 'test_loss': 0.25833406116503155}
Performance against test: {metrics}
[FedML-Server(0) @device-id-0] [Sat, 14 Jan 2023 13:04:07] [ERROR] [mlops_runtime_log.py:34:handle_exception] Uncaught exception
Traceback (most recent call last):
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/distributed_training/federated.py", line 27, in <module>
    test(args, central=False)
  File "/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/model/test.py", line 72, in test
    store_test_metrics(model_dir, avg_metrics)
  File "/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/model/utils.py", line 238, in store_test_metrics
    test_metrics_df = pd.DataFrame(test_metrics, columns = ['MAE', 'MAPE', 'MSE', 'MSLE', 'R_sq']) ; test_metrics_df.to_csv(dir_path + '/test_metrics.csv', index=False)
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/pandas/core/frame.py", line 761, in __init__
    mgr = ndarray_to_mgr(
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/pandas/core/internals/construction.py", line 349, in ndarray_to_mgr
    _check_values_indices_shape_match(values, index, columns)
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/pandas/core/internals/construction.py", line 420, in _check_values_indices_shape_match
    raise ValueError(f"Shape of passed values is {passed}, indices imply {implied}")
ValueError: Shape of passed values is (5, 1), indices imply (5, 5)