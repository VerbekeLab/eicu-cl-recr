[]
args.client_id_list = None
training_type != FEDML_TRAINING_PLATFORM_CROSS_DEVICE and training_type != FEDML_TRAINING_PLATFORM_CROSS_SILO
bsize is 2
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 22:38:34] [INFO] [__init__.py:109:print_args] ==== args = {'yaml_config_file': '/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/distributed_training/config.yml', 'run_id': '0', 'rank': 0, 'local_rank': 0, 'node_rank': 0, 'role': 'client', 'yaml_paths': ['/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/distributed_training/config.yml'], 'training_type': 'simulation', 'random_seed': 0, 'dataset': 'ICU', 'data_cache_dir': '/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/eICU_Data/', 'partition_method': 'hetero', 'partition_alpha': 0.5, 'model': 'GRU', 'input_dim': 128, 'hidden_dim': 32, 'num_layers': 2, 'output_dim': 1, 'dropout_prob': 0.05, 'model_dir': '/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/distributed_training/', 'federated_optimizer': 'FedAvg', 'client_id_list': '[]', 'client_num_in_total': 189, 'client_num_per_round': 10, 'comm_round': 20, 'epochs': 2, 'batch_size': 2, 'client_optimizer': 'adamw', 'learning_rate': 0.005, 'weight_decay': 0.005, 'frequency_of_the_test': 1, 'using_gpu': False, 'gpu_id': 0, 'backend': 'sp', 'log_file_dir': '/Users/vscheltjens/fedml-server/fedml/logs', 'enable_wandb': True, 'wandb_key': '8d579c56c0eda8929353aac11d399b96e5aa9e71', 'wandb_entity': 'vs-health', 'wandb_project': 'federated_gru_eicu', 'worker_num': 10, 'sys_perf_profiling': True, 'config_version': 'release', 'current_running_dir': '/Users/vscheltjens/fedml-client', 'os_name': 'MacOS', 'version': 'release', 'device_id': '0xC02F52N9MD6R', 'cloud_region': '', 'mqtt_config_path': '', 's3_config_path': '', 'log_server_url': 'https://open.fedml.ai/fedmlLogsServer/logs/update'}
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 22:38:34] [INFO] [ml_engine_adapter.py:147:get_torch_device] args = <fedml.arguments.Arguments object at 0x7f7b50040f70>, using_gpu = False, device_id = 0, device_type = cpu
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 22:38:34] [INFO] [device.py:48:get_device] device = cpu
Loaded Global dataloaders
81135 24698
covered hospital 0
covered hospital 1
covered hospital 2
covered hospital 3
covered hospital 4
covered hospital 5
covered hospital 6
covered hospital 7
covered hospital 8
covered hospital 9
covered hospital 10
covered hospital 11
covered hospital 12
covered hospital 13
covered hospital 14
covered hospital 15
covered hospital 16
covered hospital 17
covered hospital 18
covered hospital 19
covered hospital 20
covered hospital 21
covered hospital 22
covered hospital 23
covered hospital 24
covered hospital 25
covered hospital 26
covered hospital 27
covered hospital 28
covered hospital 29
covered hospital 30
covered hospital 31
covered hospital 32
covered hospital 33
covered hospital 34
covered hospital 35
covered hospital 36
covered hospital 37
covered hospital 38
covered hospital 39
covered hospital 40
covered hospital 41
covered hospital 42
covered hospital 43
covered hospital 44
covered hospital 45
covered hospital 46
covered hospital 47
covered hospital 48
covered hospital 49
covered hospital 50
covered hospital 51
covered hospital 52
covered hospital 53
covered hospital 54
covered hospital 55
covered hospital 56
covered hospital 57
covered hospital 58
covered hospital 59
covered hospital 60
covered hospital 61
covered hospital 62
covered hospital 63
covered hospital 64
covered hospital 65
covered hospital 66
covered hospital 67
covered hospital 68
covered hospital 69
covered hospital 70
covered hospital 71
covered hospital 72
covered hospital 73
covered hospital 74
covered hospital 75
covered hospital 76
covered hospital 77
covered hospital 78
covered hospital 79
covered hospital 80
covered hospital 81
covered hospital 82
covered hospital 83
covered hospital 84
covered hospital 85
covered hospital 86
covered hospital 87
covered hospital 88
covered hospital 89
covered hospital 90
covered hospital 91
covered hospital 92
covered hospital 93
covered hospital 94
covered hospital 95
covered hospital 96
covered hospital 97
covered hospital 98
covered hospital 99
covered hospital 100
covered hospital 101
covered hospital 102
covered hospital 103
covered hospital 104
covered hospital 105
covered hospital 106
covered hospital 107
covered hospital 108
covered hospital 109
covered hospital 110
covered hospital 111
covered hospital 112
covered hospital 113
covered hospital 114
covered hospital 115
covered hospital 116
covered hospital 117
covered hospital 118
covered hospital 119
covered hospital 120
covered hospital 121
covered hospital 122
covered hospital 123
covered hospital 124
covered hospital 125
covered hospital 126
covered hospital 127
covered hospital 128
covered hospital 129
covered hospital 130
covered hospital 131
covered hospital 132
covered hospital 133
covered hospital 134
covered hospital 135
covered hospital 136
covered hospital 137
covered hospital 138
covered hospital 139
covered hospital 140
covered hospital 141
covered hospital 142
covered hospital 143
covered hospital 144
covered hospital 145
covered hospital 146
covered hospital 147
covered hospital 148
covered hospital 149
covered hospital 150
covered hospital 151
covered hospital 152
covered hospital 153
covered hospital 154
covered hospital 155
covered hospital 156
covered hospital 157
covered hospital 158
covered hospital 159
covered hospital 160
covered hospital 161
covered hospital 162
covered hospital 163
covered hospital 164
covered hospital 165
covered hospital 166
covered hospital 167
covered hospital 168
covered hospital 169
covered hospital 170
covered hospital 171
covered hospital 172
covered hospital 173
covered hospital 174
covered hospital 175
covered hospital 176
covered hospital 177
covered hospital 178
covered hospital 179
covered hospital 180
covered hospital 181
covered hospital 182
covered hospital 183
covered hospital 184
covered hospital 185
covered hospital 186
covered hospital 187
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 23:31:36] [INFO] [fedavg_api.py:43:__init__] model = GRUModel(
  (gru): GRU(128, 32, num_layers=2, batch_first=True, dropout=0.05)
  (fc): Linear(in_features=32, out_features=1, bias=True)
  (gru_dropout): Dropout(p=0.05, inplace=False)
  (batch_norm): BatchNorm1d(1, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (relu): ReLU()
)
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 23:31:36] [INFO] [fedavg_api.py:46:__init__] self.model_trainer = <fedml.ml.trainer.icu_trainer.ModelTrainerICU object at 0x7f7b024ef310>
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 23:31:36] [INFO] [fedavg_api.py:55:_setup_clients] ############setup_clients (START)#############
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 23:31:36] [INFO] [fedavg_api.py:67:_setup_clients] ############setup_clients (END)#############
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 23:31:36] [INFO] [fedavg_api.py:70:train] self.model_trainer = <fedml.ml.trainer.icu_trainer.ModelTrainerICU object at 0x7f7b024ef310>
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 23:31:36] [INFO] [fedavg_api.py:77:train] ################Communication round : 0
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 23:31:36] [INFO] [fedavg_api.py:142:_client_sampling] client_indexes = [108  74 161  95 123  71  18 124 143   7]
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 23:31:36] [INFO] [fedavg_api.py:88:train] client_indexes = [108  74 161  95 123  71  18 124 143   7]
covered hospital 188
reached target point: model and data loaded -----> start training federated
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 23:32:00] [INFO] [fedavg_api.py:186:_local_test_on_all_clients] ################local_test_on_all_clients : 0
[FedML-Server(0) @device-id-0] [Fri, 13 Jan 2023 23:32:19] [ERROR] [mlops_runtime_log.py:34:handle_exception] Uncaught exception
Traceback (most recent call last):
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/Users/vscheltjens/Documents/PhD/Projects/eicu-cl-req/distributed_training/federated.py", line 23, in <module>
    simulator.run()
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/runner.py", line 123, in run
    self.runner.run()
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/simulation/simulator.py", line 67, in run
    self.fl_trainer.train()
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/simulation/sp/fedavg/fedavg_api.py", line 123, in train
    self._local_test_on_all_clients(round_idx)
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/simulation/sp/fedavg/fedavg_api.py", line 219, in _local_test_on_all_clients
    test_local_metrics = client.local_test(True)
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/simulation/sp/fedavg/client.py", line 35, in local_test
    metrics = self.model_trainer.test(test_data, self.device, self.args)
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/ml/trainer/icu_trainer.py", line 109, in test
    avg_metrics = [metric/(i+1) for metric in running_metrics]
  File "/usr/local/Caskroom/miniconda/base/envs/fed-cl-req-dev/lib/python3.10/site-packages/fedml/ml/trainer/icu_trainer.py", line 109, in <listcomp>
    avg_metrics = [metric/(i+1) for metric in running_metrics]
NameError: free variable 'i' referenced before assignment in enclosing scope